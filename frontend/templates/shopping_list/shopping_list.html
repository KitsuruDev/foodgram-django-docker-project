{% extends 'base.html' %}
{% load static %}

{% block title %}Список покупок - Foodgram{% endblock %}

{% block content %}
<div class="shopping-container">
    <div class="shopping-header">
        <h1><i class="fas fa-shopping-cart"></i> Список покупок</h1>
        {% if recipes %}
        <div class="shopping-actions">
            <button onclick="Foodgram.downloadShoppingList('txt')" class="btn btn-download">
                <i class="fas fa-file-alt"></i> TXT
            </button>
            <button onclick="Foodgram.downloadShoppingList('pdf')" class="btn btn-download">
                <i class="fas fa-file-pdf"></i> PDF
            </button>
            <button onclick="Foodgram.clearShoppingList()" class="btn btn-clear">
                <i class="fas fa-trash"></i> Очистить список
            </button>
        </div>
        {% endif %}
    </div>
    
    {% if recipes %}
    <div class="shopping-stats">
        <div class="stat">
            <span class="stat-number">{{ recipes_count }}</span>
            <span class="stat-label">выбранных рецептов</span>
        </div>
        <div class="stat">
            <span class="stat-number">{{ ingredients_count }}</span>
            <span class="stat-label">ингредиентов в списке</span>
        </div>
    </div>
    
    <div class="shopping-content">
        <div class="recipes-section">
            <h2><i class="fas fa-utensils"></i> Выбранные рецепты</h2>
            <div class="selected-recipes">
                {% for recipe in recipes %}
                <div class="selected-recipe">
                    <a href="{% url 'detail_recipe' recipe.id %}" class="recipe-link">
                        {% if recipe.image %}
                            <img src="{{ recipe.image.url }}" alt="{{ recipe.title }}" loading="lazy">
                        {% else %}
                            <img src="{% static 'images/default-recipe.jpg' %}" alt="Default recipe image" loading="lazy">
                        {% endif %}
                        <span>{{ recipe.title|truncatechars:40 }}</span>
                    </a>
                    <button class="remove-recipe" data-recipe-id="{{ recipe.id }}" 
                            onclick="Foodgram.removeRecipeFromShoppingList('{{ recipe.id }}')">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                {% endfor %}
            </div>
        </div>
        
        <div class="ingredients-section">
            <h2><i class="fas fa-list"></i> Список ингредиентов</h2>
            <div class="ingredients-list-shopping">
                {% for ingredient in ingredients %}
                <div class="ingredient-item">
                    <div class="ingredient-info">
                        <span class="ingredient-name">{{ ingredient.name }}</span>
                        <span class="ingredient-unit">{{ ingredient.measurement_unit }}</span>
                    </div>
                    <div class="ingredient-amount">
                        <strong>{{ ingredient.total_amount|floatformat:"-2" }}</strong>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    
    {% else %}
    <div class="empty-state">
        <img src="{% static 'images/empty-cart.svg' %}" alt="Список покупок пуст" loading="lazy">
        <h3>Ваш список покупок пуст</h3>
        <p>Добавляйте рецепты, нажав на кнопку "В покупки"</p>
        <a href="{% url 'index' %}" class="btn btn-primary">
            <i class="fas fa-search"></i> Найти рецепты
        </a>
    </div>
    {% endif %}
</div>

<style>
.shopping-stats {
    background: #f9f9f9;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 30px;
    display: flex;
    justify-content: center;
    gap: 40px;
}

.shopping-stats .stat {
    text-align: center;
}

.shopping-stats .stat-number {
    display: block;
    font-size: 32px;
    font-weight: bold;
    color: #4CAF50;
}

.shopping-stats .stat-label {
    font-size: 14px;
    color: #666;
}

@media (max-width: 768px) {
    .shopping-stats {
        flex-direction: column;
        gap: 20px;
    }
}
</style>
{% endblock %}