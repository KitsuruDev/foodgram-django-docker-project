{% extends 'base.html' %}
{% load static %}

{% block title %}{{ recipe.name }} - Foodgram{% endblock %}

{% block content %}
<div class="recipe-detail">
    <div class="recipe-header">
        <div class="recipe-image">
            {% if recipe.image %}
                <img src="{{ recipe.image.url }}" alt="{{ recipe.name }}" loading="lazy">
            {% else %}
                <img src="{% static 'images/default-recipe.jpg' %}" alt="Default recipe image" loading="lazy">
            {% endif %}
        </div>
        
        <div class="recipe-info">
            <h1>{{ recipe.name }}</h1>
            
            <div class="recipe-meta">
                <div class="author-info">
                    <a href="{% url 'users:profile' recipe.author.username %}" class="author-link">
                        {% if recipe.author.profile.avatar %}
                            <img src="{{ recipe.author.profile.avatar.url }}" alt="Аватар {{ recipe.author.username }}" class="author-avatar" loading="lazy">
                        {% else %}
                            <div class="author-avatar default-avatar">
                                <i class="fas fa-user"></i>
                            </div>
                        {% endif %}
                        <span>{{ recipe.author.get_full_name|default:recipe.author.username }}</span>
                    </a>
                    
                    {% if user.is_authenticated and user != recipe.author %}
                    <button class="subscribe-btn {% if is_subscribed %}active{% endif %}" 
                            data-author-id="{{ recipe.author.id }}">
                        {% if is_subscribed %}✓ Подписан{% else %}＋ Подписаться{% endif %}
                    </button>
                    {% endif %}
                </div>
                
                <div class="recipe-stats">
                    <span class="stat-item"><i class="fas fa-clock"></i> {{ recipe.cooking_time }} мин</span>
                    <span class="stat-item"><i class="fas fa-calendar"></i> {{ recipe.created_at|date:"d.m.Y" }}</span>
                </div>

                {% if recipe.tags.all %}
                <div class="recipe-tags">
                    {% for tag in recipe.tags.all %}
                    <span class="tag tag-{{ tag.slug|default:tag.id }}">
                        {{ tag.name }}
                    </span>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
            
            {% if user.is_authenticated %}
            <div class="recipe-actions-top">
                <button class="favorite-btn {% if recipe.is_favorited %}active{% endif %}" 
                        data-recipe-id="{{ recipe.id }}">
                    {% if recipe.is_favorited %}★ Убрать из избранного{% else %}☆ В избранное{% endif %}
                </button>
                <button class="shopping-btn {% if recipe.is_in_shopping_cart %}active{% endif %}" 
                        data-recipe-id="{{ recipe.id }}">
                    {% if recipe.is_in_shopping_cart %}✓ В списке{% else %}＋ В покупки{% endif %}
                </button>
                
                {% if user == recipe.author %}
                <a href="{% url 'edit_recipe' recipe.id %}" class="btn btn-edit">Редактировать</a>
                <a href="{% url 'delete_recipe' recipe.id %}" class="btn btn-danger" 
                   data-confirm="Вы уверены, что хотите удалить этот рецепт?">
                    <i class="fas fa-trash"></i> Удалить
                </a>
                {% endif %}
            </div>
            {% endif %}
        </div>
    </div>
    
    <div class="recipe-content">
        <div class="ingredients-section">
            <h2><i class="fas fa-carrot"></i> Ингредиенты</h2>
            <ul class="ingredients-list">
                {% for ingredient in recipe.recipe_ingredients.all %}
                <li>
                    <span class="ingredient-name">{{ ingredient.ingredient.name }}</span>
                    <span class="ingredient-amount">{{ ingredient.amount }} {{ ingredient.ingredient.measurement_unit }}</span>
                </li>
                {% empty %}
                <li class="empty-message">Ингредиенты не указаны</li>
                {% endfor %}
            </ul>
        </div>
        
        <div class="instructions-section">
            <h2><i class="fas fa-list-ol"></i> Описание</h2>
            <div class="recipe-description">
                {% if recipe.text %}
                    {{ recipe.text|linebreaks }}
                {% else %}
                    <p class="empty-message">Описание рецепта отсутствует.</p>
                {% endif %}
            </div>
        </div>
    </div>
    
    {% if user.is_authenticated %}
    <div class="recipe-share">
        <button class="btn btn-share" onclick="Foodgram.copyToClipboard(window.location.href, 'copy-message')">
            <i class="fas fa-link"></i> Скопировать ссылку
        </button>
        <span id="copy-message" class="copy-message">Ссылка скопирована!</span>
    </div>
    {% endif %}
</div>

<style>
/* Специфичные стили только для этой страницы */
.default-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #4CAF50;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 18px;
}

.copy-message {
    display: none;
    margin-left: 15px;
    color: #4CAF50;
    font-weight: 500;
}

@media (max-width: 768px) {
    .recipe-actions-top {
        flex-direction: column;
    }
    
    .recipe-actions-top .btn {
        width: 100%;
        text-align: center;
    }
}
</style>
{% endblock %}